# Migration Guide: 1.1 -> 1.2

## 1) Commands: Move to CommandSpec-first

Preferred:

```kotlin
commands {
    spec(
        command = "example",
        argsSchema = listOf(CommandArgSpec("name", CommandArgType.STRING))
    ) { _, args ->
        CommandResult.ok(args.string("name") ?: "")
    }
}
```

Why:
- deterministic middleware chain
- typed args
- built-in help/completion integration.

## 2) Events: Adopt EventSubscriptionOptions

Use explicit options when behavior matters:

```kotlin
ctx.events.subscribe<GigaTickEvent>(
    EventSubscriptionOptions(priority = EventPriority.HIGH, mainThreadOnly = true)
) { /* ... */ }
```

## 3) Host Mutations: Batch Permission Required

If using `ctx.host.applyMutationBatch(...)`, declare:

```yaml
permissions:
  - host.mutation.batch
```

and keep per-operation host permissions as before.

## 4) Adapter Security Scopes

If runtime policy enables adapter permission scopes, declare:

```yaml
permissions:
  - adapter.invoke.*
  - adapter.capability.*
```

or tighten to specific IDs/capabilities.

## 5) Assets Pipeline

Validate and bundle assets during plugin startup/build:

```kotlin
val validation = ctx.validateAssets()
val bundle = ctx.buildResourcePackBundle()
```

Fix validation failures before release; invalid bundles fail runtime reload and roll back.

## 6) Plugin Network Channels

Register channel contracts explicitly and send schema-versioned messages:

```kotlin
ctx.registerNetworkChannel(PluginChannelSpec(id = "demo:chat", schemaVersion = 1))
ctx.sendPluginMessage("demo:chat", mapOf("text" to "hello"))
```

Handle `PluginMessageStatus` for quota/backpressure/schema failures.

## 7) Observability and Recommendations

Before release, check:

- `doctor --json` and inspect plugin hotspots/fault budgets.
- `profile <plugin> --json` and inspect:
  - `slowSystems`
  - `adapterHotspots`
  - `isolatedSystems`
  - `faultBudget`.

