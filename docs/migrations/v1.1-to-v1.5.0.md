# Migration Guide: v1.1 -> v1.5.0

This guide covers plugin migration from the old `v1.1` era to the `v1.5.0` GA API/runtime.

## 1. Required API Migration

- Move to `CommandSpec`-first command registration.
- Use typed `CommandSender` and `CommandResult`.
- Replace any removed legacy command helpers (`registerValidated`, alias shortcut helpers, string-only helpers).
- Use explicit dependency specs:
  - old: dependency strings
  - new: `dependencySpecs = listOf(dependency("id", "range"))`

## 2. Event Handling Migration

- Adopt `EventSubscriptionOptions` where ordering/cancellation/threading matters.
- Prefer explicit priority and thread intent:
  - `priority`
  - `ignoreCancelled`
  - `mainThreadOnly`

## 3. Host Permission and Mutation Migration

If plugin uses host mutations, add/update manifest permissions:

```yaml
permissions:
  - host.mutation.batch
```

Keep existing fine-grained host permissions for specific operations.

## 4. Adapter Security Permission Migration

If plugin invokes adapters under scoped policy, declare:

```yaml
permissions:
  - adapter.invoke.*
  - adapter.capability.*
```

Prefer least-privilege variants when possible:

- `adapter.invoke.<adapterId>`
- `adapter.capability.<name>`

## 5. Asset Pipeline Migration

- Register assets via DSL/registry contracts.
- Validate/bundle assets before release:
  - `ctx.validateAssets()`
  - `ctx.buildResourcePackBundle()`

Invalid asset packs fail reload and trigger rollback to last good state.

## 6. Plugin Network Migration

- Register channels with explicit schema/version contract.
- Handle non-accepted message statuses (`quota`, `schema`, `backpressure`).

## 7. Ops and Diagnostics Migration

Update operator automation to consume structured diagnostics:

- `doctor --json`
- `profile <id> --json`
- recommendation payloads are structured objects:
  - `code`
  - `severity`
  - `message`

## 8. Validation Checklist

- Plugin compiles against `docs/api/v1.5.0.md`.
- Command paths migrated to `CommandSpec`.
- Required permissions declared in `clockworkplugin.yml`.
- `scan/reload/doctor/profile` pass in local standalone run.
- No unresolved recommendation codes with `severity=critical` in profile/doctor output.
