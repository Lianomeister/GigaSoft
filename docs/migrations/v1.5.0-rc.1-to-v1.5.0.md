# Migration Guide: v1.5.0-rc.1 -> v1.5.0

This guide covers the final migration delta from release candidate `v1.5.0-rc.1` to stable `v1.5.0`.

## 1. Diagnostics Recommendation Payload Change

Automation that parsed recommendation strings must switch to structured objects.

- old:
  - plain text/string recommendation entries
- new:
  - object with:
    - `code`
    - `severity`
    - `message`

Applies to:

- `doctor --json`
- `profile <id> --json`

## 2. Output Mode Flags for Operator Flows

Operator scripts can now select explicit output mode:

- `--pretty` for human-readable logs
- `--compact` for machine pipelines

Supported on:

- `doctor [--json] [--pretty|--compact]`
- `profile <id> [--json] [--pretty|--compact]`

## 3. Security Threshold Config Migration

Move any implicit/hardcoded threshold assumptions to schema-backed config keys:

- `securityConfigSchemaVersion`
- `adapterTimeoutMillis`
- `adapterRateLimitPerMinute`
- `adapterRateLimitPerMinutePerPlugin`
- `adapterMaxPayloadEntries`
- `adapterMaxPayloadTotalChars`
- `adapterMaxPayloadKeyChars`
- `adapterMaxPayloadValueChars`
- `adapterAuditRetentionMaxEntriesPerPlugin`
- `adapterAuditRetentionMaxEntriesPerAdapter`
- `adapterAuditRetentionMaxAgeMillis`
- `faultBudgetMaxFaultsPerWindow`
- `faultBudgetWindowMillis`

Validation behavior:

- invalid values fall back to safe defaults
- unsupported schema falls back to latest supported schema defaults
- startup warnings are emitted

## 4. Release Automation Migration

Release automation should consume generated manifests/checksums directly:

- `ARTIFACTS.txt`
- `ARTIFACTS.json`
- `SHA256SUMS.txt`

Do not derive release asset sets ad hoc from directory scans alone.

## 5. Verification Steps (Required)

1. Run release gate:
   - `./gradlew --no-daemon clean :clockwork-api:apiCheck test performanceBaseline standaloneReleaseCandidate integrationSmoke :clockwork-standalone:smokeTest`
2. Verify soak:
   - `./gradlew --no-daemon soakTest`
3. Verify release manifests/checksums:
   - `ARTIFACTS.txt` matches jar set
   - `SHA256SUMS.txt` verification succeeds
   - `ARTIFACTS.json` matches names/size/checksum

## 6. Quick Diff Summary

- Diagnostics JSON consumers: update parser for structured recommendations.
- Operator CLI: optionally adopt `--pretty`/`--compact`.
- Security config: migrate to explicit schema-backed keys.
- Release tooling: use generated artifact/checksum manifests.

## 7. Manifest Filename Rules (Updated)

Supported manifest filenames:

- `clockworkplugin.yml`
- `clockworktestplugin.yml`
- `clockworkdemoplugin.yml`

Runtime behavior:

- If multiple supported names are present, runtime loads in this order:
  - `clockworkplugin.yml`
  - `clockworktestplugin.yml`
  - `clockworkdemoplugin.yml`
- `gigaplugin.yml` is not supported anymore.
